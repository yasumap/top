# AGENTS.md

このファイルは、やすまっぷ（yasumap）のLPに関する意図・要件のメモです。  
実装やテキストを追加するときは、ここに書かれている思想を優先してください。必要に応じて追記・修正してください。

---

## プロジェクトの前提・世界観 🌿
- やすまっぷは、**「困りごとの大きさ」ではなく「やさしさ」を扱うプロダクト**。
- 街中で「少し座りたい」が叶う世界を広げるための取り組み。
- 使命感よりも、「あったらいいな」に寄り添うトーンを大切にする。
- LPは「説明する場所」ではなく、**想いを感じてもらう場所**。

---

## 技術スタック / 目的 🎨
- Next.js（App Router） + TypeScript + Tailwind CSS
- LPは静的サイトでOK（SSR は必須ではない）
- 役割は以下の3つ
  - ストーリーを届ける
  - 「支援したい」という気持ちを静かに後押しする
  - 「いま準備中」であることを誠実に伝える

---

## トーン＆マナー（LPの人格）😌
- やさしい／淡い／静か／落ち着き
- こちらから近づきすぎない、**半歩引いた距離感**
- 「がんばっています！」ではなく  
  👉「こんな取り組みをしています」という佇まい
- 説得・煽りはNG
- 共感を強制しない
- 「困っている人の気持ちを利用する」表現は避ける

---

## デザイン方針 🪑
- 背景は以下の画像を主役として使用  
  - `public/夕日のベンチ_LP用背景画像.png`
- できる限り手を加えない（**写真そのものの空気感を優先**）
- 強い網掛け・暗いオーバーレイは使わない  
  👉 必要な場合のみ、ごく薄く
- 1カラム構成
- 余白は「贅沢すぎるかな？」と感じるくらいでちょうど良い
- 文字は白基調、背景パネルは基本的に使わない
- 囲み枠・カードUIは原則不採用（どうしても必要な場合のみごく薄く）

---

## アニメーション方針 ✨
- フェード主体・動きは最小限
- **「動いている」ではなく「現れる」感覚**
- スクロールに応じて
  - 表示：フェードイン
  - 戻る：フェードアウト
- 速すぎるトランジションは使わない
- 見せたいのは演出ではなく「文章」

---

## コピー / 文言ポリシー 📝
- 時間帯を限定する語（例：夕暮れ・夜・朝焼け）は使わない
- 「かわいそう」「弱者」などの上下関係を連想させる言葉は使わない
- 感情を煽らない
- **寄付＝偉い、というメッセージは絶対に出さない**
- 「応援したければどうぞ」という余白を残す
- 使う言葉は短く、あいまい過ぎず、あたたかく

---

## ヒーローコピーの方針（固定）🧭
- 2行構成  
例：
> 街角に、やさしい  
> ベンチの地図を。

- 説明文は短文1つまで
- 「プロダクト名を叫ばない」

---

## ストーリー表示に関する要件 📚
- これまで議論して作ってきた**正式ストーリー文を使用**
- 1〜2行単位で分割してフェード表示
- 改行の位置も含めて「読ませ方」を設計する
- 長文を一気に読ませない
- **読めるのではなく、染みるように読む感覚**

---

## セクション構成 🗺️
1. ヒーロー  
   - 背景画像  
   - キャッチコピー  
   - 短い説明文
2. スクロールストーリー  
   - 1–2行単位で段階的に表示
3. フッター  
   - やすまっぷロゴ or テキスト  
   - 「現在開発中・準備中です」の一文  
   - 必要なら支援導線（強制しない表現で）

---

## 寄付・支援に関する扱い 💗
- 「お金をください」とは書かない
- 「応援したいと思った方へ」という**任意性を強調**
- 行動を責めない・選択を尊重
- 1円でも嬉しい、というメッセージは維持
- 見返りやリターンの強調はしない

---

## 実装メモ 🛠
- 画像  
  - `public/夕日のベンチ_LP用背景画像.png`
- ファビコン  
  - `public/椅子_ファビコン用.png` を  
    - `app/icon.png`  
    - `app/apple-icon.png` に配置
- アニメーション  
  - IntersectionObserver で isIntersecting に応じて表示/非表示
- SEO  
  - 激しいSEO対策は不要  
  - タイトルとmeta descriptionのみあっさり入れる
- アクセシビリティ  
  - コントラスト確保  
  - 代替テキストは簡潔に
  - PCでもスマホでも同じように快適に見られるように実装する

---

## LPで「やらないことリスト」🚫
- ギラギラしたバナー
- 大量のCTAボタン
- 強いセールスコピー
- 課金導線の誘導
- 「かわいそうだから支援して」の表現
- 過剰に明るいテンション

---

## これは最後に 💬
やすまっぷのLPは、  
**プロダクトの広告ではなく、「思想の入口」。**

読んだ人の心が少しだけ柔らかくなること、  
「いいな」と思ってもらえることをゴールにします。

---

## ありがとうページ / アンケートの現状整理 ✅
### できるようになっていること
- `/thanks?t=トークン` でのみ閲覧できる（トークンがない/無効なら表示しない）。
- アンケートは**1トークンにつき1回のみ回答**できる。
- 回答後もページは見られ、**回答内容が表示される**。
- 回答内容はSupabaseに保存される。
- 支援タイプメッセージは「支援理由（motive）」に応じて出し分け。

### まだできておらず、今後実装すること
- `/admin/tokens` 管理ページの運用開始（Basic認証で保護）。
- トークン発行の運用フローをチームで決定（手動発行＋手動送付が前提）。

### まだできておらず、予定も未確定のこと
- OFUSEとのWebhook連携（自動トークン発行・自動案内）。
- 自動メール送信/通知の仕組み。
- 管理画面での集計・分析ダッシュボード。

---

## トークン運用（手動前提）
### 基本方針
- **トークンは自分たちのシステムで発行**する。
- OFUSEの自動連携がない場合、**手動でURLを送る**運用とする。
- 1支援につき1トークン（再支援は新トークン）。

### トークン発行の仕組み
- `/admin/tokens` でボタン1つで発行できる。
- Basic認証で保護（環境変数に設定したユーザー名/パスワード）。
- 発行済みトークンは一覧表示・コピー可能。

---

## 環境変数（必須）
- `SUPABASE_URL`  
  - Supabaseの Project Settings → API → Project URL。
- `SUPABASE_SERVICE_ROLE_KEY`  
  - Supabaseの Project Settings → API → service_role の secret key。
  - **公開厳禁**。
- `BASIC_AUTH_USER` / `BASIC_AUTH_PASSWORD`  
  - 管理ページのBasic認証。**自分たちで決める**。

---

## 使い方（管理ページの運用）
1. `.env.local` に上記4つを設定する。
2. `npm run dev` で起動。
3. `http://localhost:3000/admin/tokens` にアクセス。
4. Basic認証でログイン。
5. 「トークンを発行する」ボタンを押す。
6. 発行されたURLを支援者に送る。

---

## 次にやること（提案）
1. **SupabaseのOrganizationに参加**  
   - 既存プロジェクトが見える状態にする（招待が必要）。
2. **環境変数の設定を完了**  
   - `SUPABASE_SERVICE_ROLE_KEY` を取得して `.env.local` に設定。
3. **管理ページの運用リハーサル**  
   - 1件トークン発行 → URL送付 → 回答保存まで一連の流れを試す。
4. （余裕が出たら）**メッセージ文言の調整**  
   - 支援タイプメッセージの出し分けを最適化する。

---

## ありがとうページ（/thanks）実装の詳細更新
### 背景・表示
- 背景画像の読み込み前は `#CBA1A4` を表示し、暗転を防ぐ。
- 画像読み込み後は背景画像が表示されるようにレイヤー構成を調整。
- ありがとうページ・ゲート画面・プレビュー画面で同じ背景挙動に統一。

### ゲート画面の文言
- タイトルは2行表示。  
  - 1行目: このページは支援者の方への  
  - 2行目: Thanksページです
- 説明文: ご支援の後お届けする専用URLからアクセスしてください

### ありがとうページ（アンケート）文言
- 見出し: 「ご支援ありがとうございます」（句点なし）。
- 説明文: 「やすまっぷの活動は、みなさまからの応援で成り立っています。」+ 改行 +  
  「1分ほどの軽いアンケートで、これからのヒントをいただけると嬉しいです。」
- 導入文: 「1分ほどお時間をいただけましたら、皆様のご意見をお聞かせください。」
- スキップ文言は控えめに表示（存在は残す）。

### アンケート構成（最新）
1. **ご支援いただいた理由（複数回答可）**
   - このサービスが広まってほしいと思った
   - 学生の取り組みを応援したいと思った
   - 自分自身もベンチに困った経験があった
   - コンセプトに共感した
   - 実際に使って役に立ったから
   - その他（選択式）
   - 「その他」選択時のみ入力欄を表示（未入力でも送信可能）
   - 表示は2列でコンパクトに
2. **やすまっぷを使ってみた印象**
   - とても使いやすかった
   - まあ使いやすかった
   - 使いづらかった
   - 使っていない
3. **自由記述（任意）**
   - 例：改善してほしい点や、応援のひとことなど

### ペンネームの扱い
- ペンネームは任意。
- 「ペンネーム」見出しの同じ行に注意書きを表示（右寄せ）。  
  - 今後のSNS上の活動報告で、ペンネームをご紹介する場合があります。
- 「ペンネームを非公開にする」チェックを用意。
- チェックは視認性の良いチェックマーク表現で統一。

### 回答後の表示
- 回答後は「支援タイプ」メッセージを表示。
- スキップ時は診断メッセージを出さず、**お礼のみ**表示。
- 回答済みは内容一覧を表示。

---

## プレビュー確認（トークンなしで表示）
- プレビューURL: `/thanks/preview`
- 送信後画面の強制表示: `/thanks/preview?done=1`

---

## 管理ページ / トークン発行
- `/admin/tokens` からトークンを発行できる。
- Basic認証で保護（`BASIC_AUTH_USER` / `BASIC_AUTH_PASSWORD`）。
- トークン一覧取得・コピー機能あり。

---

## 修正履歴メモ（直近）
- LPヒーローの説明文を簡潔化し、2行構成へ調整。
- ヒーロー上部バッジ文言を「みなさまの応援に支えられている学生プロジェクト」に変更。
- ストーリーカードを2枚に増やし、1文ずつ改行表示。

---

## 直近の変更・引き継ぎメモ（重要）
### LP / Top（`app/page.tsx`）
- CTAボタンは1つに統合。
  - 「近くのベンチを探してみる」は削除。
  - 残るボタン文言は「地図からベンチを探す」。
- ボタン説明文は「ページ下部の『地図からベンチを探す』ボタンから〜」のように位置が分かる表現へ。
- 目立たせ方はカラフル厳禁で、サイズ・余白・コントラスト・位置で強調。
- 遷移先の整理：
  - 「応援していただける方はこちら」→ `/thanks/preview`
  - 「地図からベンチを探す」→ `/coming-soon`

### Thanks / アンケート（`app/thanks/thanks-client.tsx`）
- ヒーロー説明文：
  - 「現在決済機能を実装中です。完成までもうしばらくお待ちください。」
  - 「今後より良いものにするため、皆様のお声をお聞かせいただけると幸いです。」
- 送信後メッセージ：
  - 「ご支援心から感謝いたします。」→「ご協力心から感謝いたします。」
- アンケート項目名：
  - 「ご支援いただいた理由」→「この活動に共感できる部分」
- 選択肢文言：
  - 「実際に使って役に立ったから」→「実際に使って役に立った」
- メールアドレスは必須で形式チェックあり。
  - 入力欄の位置はペンネームの下。
  - メール欄の縦余白は他より少し狭め（`space-y-2`）。

### Supabase / データ保存
- サーバー側で `SUPABASE_URL` と `SUPABASE_SERVICE_ROLE_KEY` を使って保存。
- `NEXT_PUBLIC_SUPABASE_URL` / `NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY` は現状未使用。
- 保存先を「組織のSupabaseプロジェクト」に統一したい。
  - ローカルは `.env.local` に上記2つを設定済み。
  - **本番（Vercel）では未設定**なので、このままだと組織DBに保存されない。
- Vercelの設定場所：
  - Project → Settings → Environment Variables
  - `SUPABASE_URL` / `SUPABASE_SERVICE_ROLE_KEY` を追加（Productionにチェック）
  - 追加後に再デプロイが必要
  - 画面内の Key / Value 欄にそれぞれ入力し Save（必要なら Add Another）
- `SUPABASE_SERVICE_ROLE_KEY` は秘密鍵。公開厳禁。
  - これがチャット内に露出したため、**ローテーション推奨**（Supabase側で再発行）。
- `support_entries` テーブルに `email` カラムが必要（未作成なら追加）。
  - SQL: `alter table support_entries add column if not exists email text;`

### テスト/ビルド状況
- `npm run lint` は成功。
- `npm run build` はネットワーク制限でGoogle Fonts取得失敗 → ネットワーク許可で再実行後、成功。
